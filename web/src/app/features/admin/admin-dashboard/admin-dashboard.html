<div class="main-content">
  
  <header class="top-bar">
    <div class="welcome-text">
      <h1>Panel de Control</h1>
      <p>Gestión de estudiantes y rendimiento.</p>
    </div>

    <div class="header-tools">
      <div class="status-indicator" (click)="refrescar()" title="Estado del Servidor">
        <span class="status-dot" [ngClass]="supabaseStatus"></span>
        <span class="status-text">
          {{ supabaseStatus === 'online' ? 'Online' : 
             supabaseStatus === 'offline' ? 'Offline' : '...' }}
        </span>
      </div>
    </div>
  </header>

  <div class="stats-grid">
    
    <div class="card card-blue">
      <div class="card-content">
        <span class="card-label">Estudiantes</span>
        <div class="card-value-wrapper">
            <h3 class="card-value">{{ totalEstudiantes }}</h3>
            <div class="card-icon icon-blue">
                <i class="pi pi-users"></i>
            </div>
        </div>
        <p class="card-subtext positive">
          <i class="pi pi-check-circle"></i> Activos en sistema
        </p>
      </div>
    </div>

    <div class="card card-green">
      <div class="card-content">
        <span class="card-label">Clases Hoy</span>
        <div class="card-value-wrapper">
            <h3 class="card-value">{{ clasesHoy.length }}</h3>
            <div class="card-icon icon-green">
                <i class="pi pi-calendar"></i>
            </div>
        </div>
        <p class="card-subtext" *ngIf="clasesHoy.length > 0">
          Próx: {{ clasesHoy[0].grupos?.nombre }} ({{ clasesHoy[0].hora | slice:0:5 }})
        </p>
        <p class="card-subtext text-muted" *ngIf="clasesHoy.length === 0">
          Sin actividades programadas
        </p>
      </div>
    </div>

    <div class="card card-purple">
      <div class="card-content">
        <span class="card-label">Evaluaciones</span>
        <div class="card-value-wrapper">
            <h3 class="card-value">{{ actividadReciente.length }}</h3>
            <div class="card-icon icon-purple">
                <i class="pi pi-chart-bar"></i>
            </div>
        </div>
        <p class="card-subtext">Registros recientes</p>
      </div>
    </div>
  </div>

  <section class="recent-activity-card">
    <div class="activity-header">
      <h3>Últimas Evaluaciones</h3>
      <button class="p-button-rounded p-button-text" (click)="cargarDatos()" [disabled]="loading">
        <i class="pi pi-refresh" [ngClass]="{'pi-spin': loading}"></i>
      </button>
    </div>

    <div class="activity-list">
      <div class="activity-item" *ngFor="let item of actividadReciente">
        <div class="item-icon-wrapper icon-blue">
          <i class="pi pi-star-fill"></i>
        </div>
        <div class="item-info">
          <p class="item-title">{{ item.estudiantes?.nombre }} {{ item.estudiantes?.apellido }}</p>
          <span class="item-meta">{{ item.tipo_evaluacion?.nombre }} • {{ item.fecha | date:'dd/MM' }}</span>
        </div>
        <span class="badge badge-score">{{ item.valor_numerico }} {{ item.tipo_evaluacion?.unidad_medida || '' }}</span>
      </div>

      <div class="empty-state" *ngIf="actividadReciente.length === 0 && !loading">
        <i class="pi pi-inbox"></i>
        <p>No hay actividad reciente.</p>
      </div>
    </div>
  </section>
</div>