<div class="main-content">
  
  <header class="top-bar">
    <div class="welcome-text">
      <h1>Panel de Control</h1>
      <p>Gestión de estudiantes y rendimiento.</p>
    </div>

    <div class="header-tools">
      <div class="status-indicator" (click)="refrescar()" title="Estado del Servidor">
        <span class="status-dot" [ngClass]="supabaseStatus"></span>
        <span class="status-text">
          {{ supabaseStatus === 'online' ? 'Online' : 
             supabaseStatus === 'offline' ? 'Offline' : '...' }}
        </span>
      </div>
    </div>
  </header>

  <div class="stats-grid">
    
    <div class="card card-blue">
      <div class="card-content">
        <span class="card-label">Estudiantes</span>
        <div class="card-value-wrapper">
            <h3 class="card-value">{{ totalEstudiantes }}</h3>
            <div class="card-icon icon-blue">
                <i class="pi pi-users"></i>
            </div>
        </div>
        <p class="card-subtext positive">
          <i class="pi pi-check-circle"></i> Activos en sistema
        </p>
      </div>
    </div>

    <div class="card card-green">
      <div class="card-content">
        <span class="card-label">Clases Hoy</span>
        <div class="card-value-wrapper">
            <h3 class="card-value">{{ clasesHoy.length }}</h3>
            <div class="card-icon icon-green">
                <i class="pi pi-calendar"></i>
            </div>
        </div>
        <p class="card-subtext" *ngIf="clasesHoy.length > 0">
          Próx: {{ clasesHoy[0].grupos?.nombre }} ({{ clasesHoy[0].hora | slice:0:5 }})
        </p>
        <p class="card-subtext text-muted" *ngIf="clasesHoy.length === 0">
          Sin actividades programadas
        </p>
      </div>
    </div>

    <div class="card card-purple">
      <div class="card-content">
        <span class="card-label">Evaluaciones</span>
        <div class="card-value-wrapper">
            <h3 class="card-value">{{ actividadReciente.length }}</h3>
            <div class="card-icon icon-purple">
                <i class="pi pi-chart-bar"></i>
            </div>
        </div>
        <p class="card-subtext">Registros recientes</p>
      </div>
    </div>
  </div>

  <section class="recent-activity-card">
    <div class="activity-header">
      <div class="flex align-items-center gap-2">
          <i class="pi pi-gift text-primary text-xl" style="color: #f97316;"></i>
          <h3 class="m-0">Próximos Cumpleaños (Semana)</h3>
      </div>
      <button class="p-button-rounded p-button-text" (click)="cargarDatos()" [disabled]="loading">
        <i class="pi pi-refresh" [ngClass]="{'pi-spin': loading}"></i>
      </button>
    </div>

    <div class="activity-list">
      
      <div class="activity-item" *ngFor="let est of cumpleanosList">
        <div class="item-icon-wrapper" [ngClass]="est.diasRestantes === 0 ? 'icon-orange' : 'icon-blue'">
          <i class="pi pi-user"></i>
        </div>
        
        <div class="item-info">
          <p class="item-title text-900 font-bold">
              {{ est.nombre }} {{ est.apellido }}
          </p>
          <span class="item-meta">
              {{ est.grupos?.nombre || 'Sin Grupo' }} • {{ est.proximoCumple | date:'d \'de\' MMMM' }}
          </span>
        </div>

        <div class="flex flex-column align-items-end">
            <span class="badge" [ngClass]="{
                'badge-success': est.diasRestantes === 0, 
                'badge-score': est.diasRestantes > 0
            }">
                {{ est.diasRestantes === 0 ? '¡ES HOY!' : 
                   est.diasRestantes === 1 ? 'Mañana' : 
                   'En ' + est.diasRestantes + ' días' }}
            </span>
            <small class="text-secondary text-xs mt-1">Cumplirá {{ est.nuevaEdad }} años</small>
        </div>
      </div>

      <div class="empty-state" *ngIf="cumpleanosList.length === 0 && !loading">
        <i class="pi pi-calendar-times" style="font-size: 2rem; color: var(--text-secondary); margin-bottom: 1rem;"></i>
        <p class="text-secondary m-0">No hay cumpleaños en los próximos 7 días.</p>
      </div>

    </div>
  </section>
</div>