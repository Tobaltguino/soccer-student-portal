<div class="classes-container fadein animation-duration-500">
    <header class="page-header">
        <div class="header-content">
            <h1>Mis Clases</h1>
            <p>Calendario de entrenamientos y planificaci√≥n t√©cnica</p>
        </div>
        <button pButton icon="pi pi-sync" class="p-button-rounded p-button-text" 
                (click)="cargarClases()" [loading]="loading"></button>
    </header>

    <div class="filters-container card mb-4">
        <div class="filters-row">
            <div class="filter-item">
                <p-datepicker [(ngModel)]="filtroFecha" 
                              placeholder="Filtrar por Fecha" 
                              dateFormat="dd/mm/yy"
                              (ngModelChange)="aplicarFiltros()" 
                              [showClear]="true" 
                              styleClass="w-full"></p-datepicker>
            </div>

            <div class="filter-item">
                <div class="p-input-icon-left w-full">
                    <input pInputText type="text" 
                           [(ngModel)]="filtroLugar" 
                           (input)="aplicarFiltros()" 
                           placeholder="Buscar por lugar..." 
                           class="w-full"/>
                </div>
            </div>

            <div class="filter-item">
                <p-select [options]="opcionesAsistencia" 
                          [(ngModel)]="filtroAsistencia" 
                          placeholder="Estado Asistencia" 
                          (onChange)="aplicarFiltros()" 
                          [showClear]="true" 
                          styleClass="w-full"></p-select>
            </div>

            <div class="filter-item button-item">
                <button pButton icon="pi pi-filter-slash" 
                        class="p-button-outlined p-button-secondary w-full" 
                        (click)="limpiarFiltros()" 
                        pTooltip="Limpiar Filtros"></button>
            </div>
        </div>
    </div>

    <div class="card-table table-responsive">
        <p-table [value]="clases" [loading]="loading" [rows]="10" [paginator]="true" 
                 styleClass="p-datatable-sm" [rowHover]="true" responsiveLayout="stack" [breakpoint]="'960px'">
            
            <ng-template pTemplate="header">
                <tr>
                    <th style="width: 25%"><i class="pi pi-calendar"></i>Fecha / Hora</th>
                    <th style="width: 30%"><i class="pi pi-map-marker"></i>Lugar</th>
                    <th style="width: 25%"><i class="pi pi-check-square"></i>Asistencia</th>
                    <th style="width: 20%" class="text-center"><i class="pi pi-book"></i>Planificaci√≥n</th>
                </tr>
            </ng-template>

            <ng-template pTemplate="body" let-clase>
                <tr>
                    <td>
                        <span class="p-column-title">Fecha / Hora</span>
                        <div class="flex flex-column">
                            <div class="font-bold text-main">{{ clase.fecha | date:'dd/MM/yyyy' }}</div>
                            <div class="text-sm text-500 flex align-items-center mt-1">
                                <i class="pi pi-clock"></i>{{ clase.hora | slice:0:5 }} hrs
                            </div>
                        </div>
                    </td>
                    <td>
                        <span class="p-column-title">Lugar</span>
                        <div class="text-main">{{ clase.lugar || 'Cancha Principal' }}</div>
                    </td>
                    <td>
                        <span class="p-column-title">Asistencia</span>
                        <p-tag [value]="getAsistenciaLabel(clase.presente)" 
                               [severity]="getAsistenciaSeverity(clase.presente)"></p-tag>
                    </td>
                    <td class="text-center">
                        <span class="p-column-title">Planificaci√≥n</span>
                        <button pButton icon="pi pi-eye" class="p-button-text p-button-info p-button-rounded" 
                                (click)="verPlanificacion(clase)" pTooltip="Ver Planificaci√≥n"></button>
                    </td>
                </tr>
            </ng-template>

            <ng-template pTemplate="emptymessage">
                <tr>
                    <td colspan="4" class="text-center p-5 text-secondary">
                        No hay clases que coincidan con los filtros aplicados.
                    </td>
                </tr>
            </ng-template>
        </p-table>
    </div>

    <p-dialog [(visible)]="displayPlan" header="Detalle del Entrenamiento" 
              [modal]="true" [style]="{width: '90vw', maxWidth: '500px'}" styleClass="p-fluid">
        
        <div *ngIf="selectedClase" class="animation-fade-in">
            <div class="field mb-4">
                <label class="font-bold text-primary"><i class="pi pi-directions"></i> Objetivo Principal</label>
                <div class="surface-ground p-3 border-round border-1 border-200">
                    {{ selectedClase.objetivo && selectedClase.objetivo !== 'EMPTY' ? selectedClase.objetivo : 'Sin objetivo definido' }}
                </div>
            </div>

            <div class="formgrid grid">
                <div class="field col-12 mb-3">
                    <label class="font-bold"><span class="mr-2">üî•</span> Calentamiento</label>
                    <div class="text-sm bg-gray-100 p-3 border-round border-1 border-200">
                        {{ selectedClase.calentamiento && selectedClase.calentamiento !== 'EMPTY' ? selectedClase.calentamiento : 'No especificado' }}
                    </div>
                </div>
                <div class="field col-12 mb-3">
                    <label class="font-bold"><span class="mr-2">‚öΩ</span> Parte Principal</label>
                    <div class="text-sm bg-gray-100 p-3 border-round border-1 border-200">
                        {{ selectedClase.parte_principal && selectedClase.parte_principal !== 'EMPTY' ? selectedClase.parte_principal : 'No especificada' }}
                    </div>
                </div>
                <div class="field col-12 mb-3">
                    <label class="font-bold"><span class="mr-2">‚ùÑÔ∏è</span> Vuelta a la Calma</label>
                    <div class="text-sm bg-gray-100 p-3 border-round border-1 border-200">
                        {{ selectedClase.vuelta_calma && selectedClase.vuelta_calma !== 'EMPTY' ? selectedClase.vuelta_calma : 'No especificada' }}
                    </div>
                </div>
            </div>
        </div>

        <ng-template pTemplate="footer">
            <button pButton label="Cerrar" icon="pi pi-times" class="p-button-text" (click)="displayPlan = false"></button>
        </ng-template>
    </p-dialog>
</div>